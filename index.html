<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>MTM Coin - Ultra Pro Max</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { 
            --gold: linear-gradient(135deg, #ffcc00, #ff9900); 
            --bg: #05050a; 
            --card-bg: rgba(28, 28, 46, 0.8);
        }
        
        body { 
            background: var(--bg); 
            color: white; 
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; 
            margin: 0; 
            overflow: hidden; 
            -webkit-user-select: none; 
            user-select: none; 
            touch-action: manipulation; 
        }

        /* ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø®Ù„ÙÙŠØ© */
        body::before {
            content: "";
            position: fixed;
            top: -50%; left: -50%; width: 200%; height: 200%;
            background: radial-gradient(circle, rgba(255,204,0,0.05) 0%, rgba(0,0,0,0) 70%);
            z-index: -1;
        }

        .lang-overlay { position: fixed; inset: 0; background: var(--bg); z-index: 1000; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 20px; }
        
        .header { 
            padding: 15px; 
            background: rgba(22, 22, 37, 0.9); 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            backdrop-filter: blur(10px);
            border-bottom: 1px solid #333;
        }

        #balance { 
            font-size: 48px; 
            font-weight: 900; 
            background: var(--gold); 
            -webkit-background-clip: text; 
            -webkit-text-fill-color: transparent; 
            text-align: center; 
            margin: 20px 0;
            text-shadow: 0 10px 20px rgba(255,204,0,0.2);
        }

        .content { height: 75vh; overflow-y: auto; padding-bottom: 100px; }
        .page { display: none; padding: 20px; animation: fadeIn 0.3s ease; }
        .page.active { display: block; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* ØªØ£Ø«ÙŠØ± Ø§Ù„Ø¹Ù…Ù„Ø© Ø§Ù„Ø£Ø³Ø·ÙˆØ±ÙŠ */
        .game-area { position: relative; height: 300px; display: flex; align-items: center; justify-content: center; }
        #coin-container { position: relative; transition: transform 0.1s; }
        #coin { width: 240px; filter: drop-shadow(0 0 30px rgba(255,204,0,0.3)); cursor: pointer; }
        
        /* Ø£Ø±Ù‚Ø§Ù… Ø·Ø§Ø¦Ø±Ø© */
        .float-text {
            position: absolute;
            color: #ffcc00;
            font-weight: bold;
            font-size: 24px;
            pointer-events: none;
            animation: floatUp 0.8s ease-out forwards;
            z-index: 100;
        }

        @keyframes floatUp {
            0% { opacity: 1; transform: translateY(0); }
            100% { opacity: 0; transform: translateY(-100px); }
        }

        .energy-bar { width: 90%; background: #1a1a1a; height: 14px; border-radius: 20px; margin: 15px auto; border: 1px solid #333; overflow: hidden; }
        #energy-fill { background: var(--gold); height: 100%; width: 100%; transition: width 0.3s ease; box-shadow: 0 0 10px rgba(255,204,0,0.5); }

        .card { 
            background: var(--card-bg); 
            padding: 15px; 
            border-radius: 15px; 
            margin-bottom: 12px; 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            border: 1px solid rgba(255,255,255,0.05);
            backdrop-filter: blur(5px);
        }

        .btn { 
            background: var(--gold); 
            color: #000; 
            padding: 10px 20px; 
            border-radius: 10px; 
            font-weight: bold; 
            border: none; 
            box-shadow: 0 4px 15px rgba(255,204,0,0.3);
            transition: 0.2s;
        }
        .btn:active { transform: scale(0.95); }

        .nav-bar { 
            position: fixed; bottom: 0; width: 100%; display: flex; 
            background: rgba(22, 22, 37, 0.95); backdrop-filter: blur(15px);
            border-top: 1px solid #333; padding: 15px 0; z-index: 100;
        }
        .nav-item { flex: 1; text-align: center; color: #666; transition: 0.3s; }
        .nav-item.active { color: #ffcc00; transform: translateY(-5px); }
        .nav-item i { font-size: 22px; margin-bottom: 5px; }
    </style>
</head>
<body>

    <div id="lang-page" class="lang-overlay">
        <h2 style="color: #ffcc00;">MTM COIN</h2>
        <button class="btn" style="width:200px" onclick="setLang('ar')">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</button>
        <button class="btn" style="width:200px" onclick="setLang('en')">English</button>
    </div>

    <div class="header">
        <div id="league-txt" style="background: rgba(255,204,0,0.1); padding: 5px 12px; border-radius: 20px; color: #ffcc00; font-size: 13px;">ğŸ¥‰ Ø¨Ø±ÙˆÙ†Ø²ÙŠ</div>
        <div id="uid-display" style="font-size:11px; color:#666; font-family: monospace;">ID: ...</div>
    </div>

    <div class="content">
        <div id="game-page" class="page active">
            <div id="balance">0</div>
            
            <div class="game-area">
                <div id="coin-container" onclick="handleTap(event)">
                    <img src="https://i.ibb.co/L1mP94w/mtm-coin.png" id="coin" alt="MTM">
                </div>
            </div>

            <div style="display: flex; justify-content: space-between; width: 90%; margin: 0 auto; font-size: 14px;">
                <span id="energy-txt">âš¡ 1000 / 1000</span>
                <span><i class="fas fa-bolt" style="color: #ffcc00;"></i> <span id="pwr-val">1</span></span>
            </div>
            <div class="energy-bar"><div id="energy-fill"></div></div>
        </div>

        <div id="leader-page" class="page">
            <h3 id="rank-title">Ø§Ù„Ù…ØªØµØ¯Ø±ÙˆÙ† ğŸ†</h3>
            <div class="card" style="border:1px solid #ffcc00"><span>1. Ù…Ø¹ØªØµÙ… Ø§Ù„Ù…Ù„ÙŠÙƒÙŠ ğŸ‘‘</span><span style="color:#ffcc00">5.8M</span></div>
            <div class="card"><span id="your-name">Ø£Ù†Øª</span><span id="your-rank-score">0</span></div>
        </div>

        <div id="tasks-page" class="page">
            <h3 id="up-title">Ø§Ù„ØªØ·ÙˆÙŠØ±Ø§Øª</h3>
            <div class="card">
                <div><b class="t-p1">Ù‚ÙˆØ© Ø§Ù„Ù†Ù‚Ø±</b><br><small id="c1-txt" style="color:#888;">Ø§Ù„Ø³Ø¹Ø±: 2000</small></div>
                <button class="btn" onclick="upgrade('tap')">ØªØ·ÙˆÙŠØ±</button>
            </div>
            <div class="card">
                <div><b class="t-p2">Ù…Ø®Ø²Ù† Ø§Ù„Ø·Ø§Ù‚Ø©</b><br><small id="c2-txt" style="color:#888;">Ø§Ù„Ø³Ø¹Ø±: 5000</small></div>
                <button class="btn" onclick="upgrade('energy')">ØªØ·ÙˆÙŠØ±</button>
            </div>
            <h3 id="task-title">Ø§Ù„Ù…Ù‡Ø§Ù…</h3>
            <div class="card">
                <div><b>Ù‚Ù†Ø§Ø© Ø§Ù„ØªÙ„ÙŠØ¬Ø±Ø§Ù…</b><br><small style="color: #4cd137;">+50,000</small></div>
                <button class="btn" id="btn-tg" onclick="doTask('tg', 50000, 'https://t.me/MTM_coin')">Ø§Ù†Ø¶Ù…</button>
            </div>
        </div>

        <div id="ref-page" class="page">
            <h3 id="ref-title">Ø§Ù„Ø¥Ø­Ø§Ù„Ø§Øª ğŸ‘¥</h3>
            <div class="card" style="flex-direction:column; gap:15px; padding: 25px;">
                <span id="f-txt" style="font-size: 18px;">Ø§Ù„Ø£ØµØ¯Ù‚Ø§Ø¡: <b id="ref-count" style="color: #ffcc00;">0</b></span>
                <input type="text" id="reflink" readonly style="width:100%; padding:12px; background:rgba(0,0,0,0.3); color:#ffcc00; border:1px solid #444; text-align:center; border-radius:10px;">
                <button class="btn" style="width:100%;" id="share-txt" onclick="shareRef()">Ø§Ø±Ø³Ù„ Ø§Ù„Ø±Ø§Ø¨Ø· ğŸ”—</button>
            </div>
        </div>
    </div>

    <div class="nav-bar">
        <div class="nav-item active" onclick="showP('game-page', this)"><i class="fas fa-coins"></i><br><span class="n-1">Ù†Ù‚Ø±</span></div>
        <div class="nav-item" onclick="showP('leader-page', this)"><i class="fas fa-trophy"></i><br><span class="n-2">ØªØ±ØªÙŠØ¨</span></div>
        <div class="nav-item" onclick="showP('tasks-page', this)"><i class="fas fa-bolt"></i><br><span class="n-3">Ù…Ù‡Ø§Ù…</span></div>
        <div class="nav-item" onclick="showP('ref-page', this)"><i class="fas fa-users"></i><br><span class="n-4">Ø¥Ø­Ø§Ù„Ø©</span></div>
    </div>

    <script>
        // ... (ÙƒÙˆØ¯ Firebase Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ Ù‡Ù†Ø§) ...
        const firebaseConfig = {
            apiKey: "AIzaSyA1Nnh0P7RdWH7EhBnaGkk6QUNeWRXPKt8",
            databaseURL: "https://mtm-coin-a52d9-default-rtdb.firebaseio.com"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        const tg = window.Telegram.WebApp;
        tg.expand();
        const user = tg.initDataUnsafe.user;
        const uid = user ? user.id : "Player_" + Math.floor(Math.random()*1000);
        document.getElementById('uid-display').innerText = "ID: " + uid;
        const BOT_NAME = "MTM_Coin_App_bot";
        const referrerId = tg.initDataUnsafe.start_param;

        let score = 0, refs = 0, tapPower = 1, energyLvl = 0, energy = 1000, maxEnergy = 1000, tasks = {tg:false, ig:false};
        let currentLang = localStorage.getItem('lang') || null;

        const langData = {
            ar: { n1:"Ù†Ù‚Ø±", n2:"ØªØ±ØªÙŠØ¨", n3:"Ù…Ù‡Ø§Ù…", n4:"Ø¥Ø­Ø§Ù„Ø©", upT:"Ø§Ù„ØªØ·ÙˆÙŠØ±Ø§Øª", taskT:"Ø§Ù„Ù…Ù‡Ø§Ù…", refT:"Ø§Ù„Ø¥Ø­Ø§Ù„Ø§Øª", ftxt:"Ø§Ù„Ø£ØµØ¯Ù‚Ø§Ø¡: ", share:"Ø§Ø±Ø³Ù„ Ø§Ù„Ø±Ø§Ø¨Ø· ğŸ”—", rankT:"Ø§Ù„Ù…ØªØµØ¯Ø±ÙˆÙ† ğŸ†", you:"Ø£Ù†Øª", p1:"Ù‚ÙˆØ© Ø§Ù„Ù†Ù‚Ø±", p2:"Ù…Ø®Ø²Ù† Ø§Ù„Ø·Ø§Ù‚Ø©", done:"Ù…ÙƒØªÙ…Ù„ âœ“" },
            en: { n1:"Tap", n2:"Rank", n3:"Tasks", n4:"Ref", upT:"Upgrades", taskT:"Tasks", refT:"Referrals", ftxt:"Friends: ", share:"Share Link ğŸ”—", rankT:"Leaders ğŸ†", you:"You", p1:"Tap Power", p2:"Energy Cap", done:"Done âœ“" }
        };

        // Ø¯Ø§Ù„Ø© Ø§Ù„Ø§Ù‡ØªØ²Ø§Ø² (Haptic)
        function haptic() {
            if (tg.HapticFeedback) tg.HapticFeedback.impactOccurred('medium');
        }

        // Ø¯Ø§Ù„Ø© Ø§Ù„Ù†Ù‚Ø± Ø§Ù„Ù…Ø·ÙˆØ± Ù…Ø¹ Ø§Ù„Ø£Ù†ÙŠÙ…ÙŠØ´Ù†
        function handleTap(event) {
            if(energy >= tapPower) {
                haptic();
                energy -= tapPower; 
                score += tapPower;
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                db.ref('users/' + uid + '/score').set(score);
                
                // ØªØ£Ø«ÙŠØ± Ø§Ù„Ø¹Ù…Ù„Ø©
                const coin = document.getElementById('coin-container');
                coin.style.transform = "scale(0.95) rotate("+(Math.random()*4-2)+"deg)";
                setTimeout(() => coin.style.transform = "scale(1)", 50);

                // Ø¥Ù†Ø´Ø§Ø¡ Ø±Ù‚Ù… Ø·Ø§Ø¦Ø±
                const rect = event.target.getBoundingClientRect();
                const x = (event.clientX || event.touches[0].clientX) - rect.left;
                const y = (event.clientY || event.touches[0].clientY) - rect.top;
                
                const floatText = document.createElement('div');
                floatText.className = 'float-text';
                floatText.innerText = `+${tapPower}`;
                floatText.style.left = `${x}px`;
                floatText.style.top = `${y}px`;
                document.querySelector('.game-area').appendChild(floatText);
                
                setTimeout(() => floatText.remove(), 800);
                updateUI();
            }
        }

        function updateUI() {
            if(!currentLang) return;
            const t = langData[currentLang];
            document.getElementById('balance').innerText = score.toLocaleString();
            document.getElementById('pwr-val').innerText = tapPower;
            document.getElementById('ref-count').innerText = refs;
            document.getElementById('your-rank-score').innerText = score.toLocaleString();
            document.getElementById('energy-txt').innerText = `âš¡ ${energy} / ${maxEnergy}`;
            document.getElementById('energy-fill').style.width = (energy/maxEnergy*100) + "%";
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù„ÙŠØ¬ (Leagues)
            let league = "ğŸ¥‰ Ø¨Ø±ÙˆÙ†Ø²ÙŠ";
            if(score > 1000000) league = "ğŸ‘‘ Ø£Ø³Ø·ÙˆØ±ÙŠ";
            else if(score > 500000) league = "ğŸ’ Ù…Ø§Ø³ÙŠ";
            else if(score > 100000) league = "ğŸ¥‡ Ø°Ù‡Ø¨ÙŠ";
            else if(score > 50000) league = "ğŸ¥ˆ ÙØ¶ÙŠ";
            document.getElementById('league-txt').innerText = league;

            // Ù†ØµÙˆØµ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
            document.querySelector('.n-1').innerText = t.n1; document.querySelector('.n-2').innerText = t.n2;
            document.querySelector('.n-3').innerText = t.n3; document.querySelector('.n-4').innerText = t.n4;
            document.getElementById('up-title').innerText = t.upT; 
            document.getElementById('task-title').innerText = t.taskT;
            document.getElementById('ref-title').innerText = t.refT; 
            document.getElementById('share-txt').innerText = t.share;
            document.getElementById('rank-title').innerText = t.rankT; 
            document.getElementById('your-name').innerText = t.you;
            document.querySelector('.t-p1').innerText = t.p1; 
            document.querySelector('.t-p2').innerText = t.p2;

            document.getElementById('c1-txt').innerText = `Price: ${tapPower * 2000}`;
            document.getElementById('c2-txt').innerText = `Price: ${Math.pow(2, energyLvl) * 5000}`;

            if(tasks.tg) { document.getElementById('btn-tg').innerText = t.done; document.getElementById('btn-tg').disabled = true; }
            document.getElementById('reflink').value = `https://t.me/${BOT_NAME}?start=${uid}`;
        }

        // Ø§Ù„Ø¯ÙˆØ§Ù„ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© (ØªØ¹Ø¯ÙŠÙ„ Ø·ÙÙŠÙ Ù„Ø¶Ù…Ø§Ù† Ø§Ù„ØªÙˆØ§ÙÙ‚)
        function setLang(l) {
            currentLang = l; localStorage.setItem('lang', l);
            document.getElementById('lang-page').style.display = 'none';
            document.body.style.direction = (l === 'ar') ? 'rtl' : 'ltr';
            initUser();
            updateUI();
        }

        function showP(id, el) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            document.getElementById(id).classList.add('active'); 
            el.classList.add('active');
            haptic();
        }

        function initUser() {
            const uRef = db.ref('users/' + uid);
            uRef.get().then((s) => {
                if (!s.exists()) {
                    uRef.set({ score: 0, refs: 0, tapPower: 1, energyLvl: 0, tasks: {tg:false} });
                }
            });
        }

        db.ref('users/' + uid).on('value', (s) => {
            const d = s.val();
            if(d) {
                score = d.score; refs = d.refs; tapPower = d.tapPower || 1;
                energyLvl = d.energyLvl || 0; tasks = d.tasks || {tg:false};
                maxEnergy = 1000 + (energyLvl * 500);
                updateUI();
            }
        });

        function upgrade(type) {
            haptic();
            if(type === 'tap') {
                let cost = tapPower * 2000;
                if(score >= cost) { score -= cost; tapPower++; db.ref('users/' + uid).update({score, tapPower}); }
            } else {
                let cost = Math.pow(2, energyLvl) * 5000;
                if(score >= cost) { score -= cost; energyLvl++; db.ref('users/' + uid).update({score, energyLvl}); }
            }
        }

        function doTask(type, reward, link) {
            window.open(link, '_blank');
            setTimeout(() => {
                if(!tasks[type]) {
                    score += reward; tasks[type] = true;
                    db.ref('users/' + uid).update({ score: score, tasks: tasks });
                }
            }, 5000);
        }

        function shareRef() {
            const link = `https://t.me/${BOT_NAME}?start=${uid}`;
            tg.openTelegramLink(`https://t.me/share/url?url=${encodeURIComponent(link)}&text=Join MTM Coin and earn!`);
        }

        setInterval(() => { if(energy < maxEnergy) { energy = Math.min(maxEnergy, energy + 3); updateUI(); } }, 1000);
        if(currentLang) { setLang(currentLang); }
    </script>
</body>
</html>
