<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>MTM Coin - Ultimate Edition</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --gold: linear-gradient(135deg, #ffcc00, #ff9900);
            --bg: #050508;
            --card-bg: #121220;
            --accent: #ffcc00;
        }

        body {
            background: var(--bg); color: white; font-family: 'Segoe UI', sans-serif;
            margin: 0; overflow: hidden; -webkit-user-select: none; user-select: none;
            touch-action: manipulation; direction: rtl;
            /* Ø­Ù„ Ù…Ø´ÙƒÙ„Ø© Ø§Ù„Ù…Ø±Ø¨Ø¹ Ø§Ù„Ø£Ø²Ø±Ù‚ */
            -webkit-tap-highlight-color: transparent;
        }

        .header {
            padding: 15px; background: rgba(22, 22, 37, 0.8); backdrop-filter: blur(10px);
            display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #222;
        }

        #balance-container { text-align: center; margin: 20px 0; }
        #balance {
            font-size: 45px; font-weight: 900; background: var(--gold);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            filter: drop-shadow(0 0 10px rgba(255,204,0,0.2));
        }

        .coin-wrapper { position: relative; display: flex; justify-content: center; align-items: center; height: 240px; }
        #coin {
            width: 200px; height: 200px; cursor: pointer;
            transition: transform 0.1s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            filter: drop-shadow(0 0 20px rgba(255, 204, 0, 0.3));
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
        }
        #coin:active { transform: scale(0.92); }

        .tap-effect {
            position: absolute; color: #ffcc00; font-size: 28px; font-weight: bold;
            pointer-events: none; animation: floatUp 0.7s ease-out forwards; z-index: 100;
        }
        @keyframes floatUp { 0% { opacity: 1; transform: translateY(0); } 100% { opacity: 0; transform: translateY(-130px); } }

        .energy-bar-container { width: 85%; height: 10px; background: #222; border-radius: 10px; margin: 10px auto; overflow: hidden; border: 1px solid #333; }
        #energy-fill { height: 100%; width: 100%; background: var(--gold); transition: width 0.3s; }

        .page { display: none; padding: 20px; animation: fadeIn 0.3s; height: 75vh; overflow-y: auto; padding-bottom: 100px; -webkit-tap-highlight-color: transparent; }
        .page.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .card {
            background: var(--card-bg); padding: 15px; border-radius: 15px;
            margin-bottom: 12px; display: flex; align-items: center; border: 1px solid #222;
        }
        .card i { font-size: 22px; margin-left: 15px; color: var(--accent); }
        .info { flex-grow: 1; text-align: right; }

        .btn {
            background: var(--gold); color: #000; padding: 8px 16px; border-radius: 10px;
            font-weight: 800; border: none; cursor: pointer; -webkit-tap-highlight-color: transparent;
        }
        .btn:disabled { background: #444; color: #888; cursor: not-allowed; }

        .nav-bar {
            position: fixed; bottom: 15px; left: 5%; width: 90%;
            display: flex; background: rgba(22, 22, 37, 0.95); backdrop-filter: blur(15px);
            border-radius: 20px; padding: 10px 0; border: 1px solid #333; z-index: 1000;
        }
        .nav-item { flex: 1; text-align: center; color: #666; font-size: 11px; -webkit-tap-highlight-color: transparent; }
        .nav-item.active { color: var(--accent); transform: translateY(-3px); transition: 0.3s; }

        #lang-btn { background: #222; color: gold; border: 1px solid gold; padding: 4px 10px; border-radius: 8px; font-size: 11px; }
    </style>
</head>
<body>

<div class="header">
    <div id="level-txt">Lvl: 1</div>
    <button id="lang-btn" onclick="toggleLang()">EN / Ø¹Ø±Ø¨ÙŠ</button>
</div>

<div class="content">
    <div id="game-page" class="page active">
        <div id="balance-container">
            <div id="balance-label" style="font-size:12px; color:#aaa;">Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„ÙƒÙ„ÙŠ</div>
            <div id="balance">0</div>
        </div>
        <div class="coin-wrapper">
            <img src="coin.png" id="coin" onpointerdown="handleTap(event)" onerror="this.src='https://cdn-icons-png.flaticon.com/512/6001/6001527.png'">
        </div>
        <div style="text-align: center;">
            <div style="margin-bottom: 5px;"><span id="energy-label">Ø§Ù„Ø·Ø§Ù‚Ø©</span>: <span id="energy-txt">1000/1000</span></div>
            <div class="energy-bar-container"><div id="energy-fill"></div></div>
        </div>
        
        <div class="card" style="margin-top:20px; background: rgba(255,204,0,0.05); border-color: gold;">
            <i class="fas fa-gift"></i>
            <div class="info">
                <b id="daily-reward-title">Ù‡Ø¯ÙŠØ© ÙŠÙˆÙ…ÙŠØ©</b><br>
                <small id="daily-reward-desc">Ø§Ø­ØµÙ„ Ø¹Ù„Ù‰ 5,000 ÙƒÙˆÙŠÙ†</small>
            </div>
            <button class="btn" id="daily-btn" onclick="claimDaily()">Claim</button>
        </div>
    </div>

    <div id="boost-page" class="page">
        <h2 id="boost-title">Ø§Ù„ØªØ·ÙˆÙŠØ±Ø§Øª âš¡</h2>
        <div class="card">
            <i class="fas fa-hand-pointer"></i>
            <div class="info">
                <b id="tap-boost-name">Ù‚ÙˆØ© Ø§Ù„Ù†Ù‚Ø±Ø©</b><br>
                <small id="tap-boost-desc">Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø±Ø¨Ø­ Ù…Ù† ÙƒÙ„ Ù†Ù‚Ø±Ø©</small>
            </div>
            <button class="btn" onclick="buyUpgrade('tap')"><span id="tap-price">500</span></button>
        </div>
        <div class="card">
            <i class="fas fa-battery-full"></i>
            <div class="info">
                <b id="energy-boost-name">Ù…Ø®Ø²ÙˆÙ† Ø§Ù„Ø·Ø§Ù‚Ø©</b><br>
                <small id="energy-boost-desc">Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø³Ø¹Ø© Ø§Ù„Ù‚ØµÙˆÙ‰</small>
            </div>
            <button class="btn" onclick="buyUpgrade('energy')"><span id="energy-price">1000</span></button>
        </div>
    </div>

    <div id="tasks-page" class="page">
        <h2 id="tasks-title">Ø§Ù„Ù…Ù‡Ø§Ù… ðŸš€</h2>
        <div class="card">
            <i class="fab fa-telegram"></i>
            <div class="info"><b>Ù‚Ù†Ø§Ø© Ø§Ù„ØªÙ„ÙŠØ¬Ø±Ø§Ù…</b><br><small>+50,000</small></div>
            <button class="btn" id="btn-tg" onclick="doTask('tg', 50000, 'https://t.me/MTM_coin')">Go</button>
        </div>
    </div>

    <div id="ref-page" class="page">
        <h2 id="ref-title">Ø¯Ø¹ÙˆØ© Ø§Ù„Ø£ØµØ¯Ù‚Ø§Ø¡ ðŸ‘¥</h2>
        <div class="card" style="display:block; text-align:center">
            <p id="ref-desc">Ø§Ø±Ø¨Ø­ 50,000 Ø¹Ù† ÙƒÙ„ ØµØ¯ÙŠÙ‚!</p>
            <input type="text" id="reflink" readonly style="width:90%; padding:10px; background:#000; color:gold; border:1px solid #333; border-radius:10px; text-align:center; margin-bottom:10px">
            <button class="btn" style="width:100%" id="ref-btn-share" onclick="shareRef()">Ø§Ø±Ø³Ù„ Ø§Ù„Ø±Ø§Ø¨Ø· ðŸ”—</button>
        </div>
    </div>
</div>

<div class="nav-bar">
    <div class="nav-item active" onclick="showP('game-page',this)"><i class="fas fa-coins"></i><br><span id="nav-tap">Ù†Ù‚Ø±</span></div>
    <div class="nav-item" onclick="showP('boost-page',this)"><i class="fas fa-bolt"></i><br><span id="nav-boost">ØªØ·ÙˆÙŠØ±</span></div>
    <div class="nav-item" onclick="showP('tasks-page',this)"><i class="fas fa-tasks"></i><br><span id="nav-task">Ù…Ù‡Ø§Ù…</span></div>
    <div class="nav-item" onclick="showP('ref-page',this)"><i class="fas fa-users"></i><br><span id="nav-ref">Ø¥Ø­Ø§Ù„Ø©</span></div>
</div>

<script>
// --- ØªÙ‡ÙŠØ¦Ø© Firebase ---
const firebaseConfig = { apiKey: "AIzaSyA1Nnh0P7RdWH7EhBnaGkk6QUNeWRXPKt8", databaseURL: "https://mtm-coin-a52d9-default-rtdb.firebaseio.com" };
firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const tg = window.Telegram.WebApp;
tg.expand();

// --- Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ§Ù„Ø­Ø§Ù„Ø© ---
const uid = tg.initDataUnsafe.user ? tg.initDataUnsafe.user.id : "12345";
let userData = {
    score: 0, energy: 1000, maxEnergy: 1000, tapPower: 1,
    upgrades: { tap: 0, energy: 0 }, tasks: { tg: false },
    lastClaim: 0
};

let currentLang = localStorage.getItem('lang') || 'ar';

const langData = {
    ar: {
        balanceLabel: "Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„ÙƒÙ„ÙŠ", energyLabel: "Ø§Ù„Ø·Ø§Ù‚Ø©", boostTitle: "Ø§Ù„ØªØ·ÙˆÙŠØ±Ø§Øª âš¡",
        tapName: "Ù‚ÙˆØ© Ø§Ù„Ù†Ù‚Ø±Ø©", tapDesc: "Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø±Ø¨Ø­ Ù…Ù† ÙƒÙ„ Ù†Ù‚Ø±Ø©", energyName: "Ù…Ø®Ø²ÙˆÙ† Ø§Ù„Ø·Ø§Ù‚Ø©",
        energyDesc: "Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø³Ø¹Ø© Ø§Ù„Ù‚ØµÙˆÙ‰", tasksTitle: "Ø§Ù„Ù…Ù‡Ø§Ù… ðŸš€", refTitle: "Ø§Ù„Ø£ØµØ¯Ù‚Ø§Ø¡ ðŸ‘¥",
        refDesc: "Ø§Ø±Ø¨Ø­ 50,000 Ø¹Ù† ÙƒÙ„ ØµØ¯ÙŠÙ‚!", navTap: "Ù†Ù‚Ø±", navBoost: "ØªØ·ÙˆÙŠØ±", navTask: "Ù…Ù‡Ø§Ù…", navRef: "Ø¥Ø­Ø§Ù„Ø©",
        shareBtn: "Ø§Ø±Ø³Ù„ Ø§Ù„Ø±Ø§Ø¨Ø· ðŸ”—", dailyTitle: "Ù‡Ø¯ÙŠØ© ÙŠÙˆÙ…ÙŠØ©", dailyDesc: "Ø§Ø­ØµÙ„ Ø¹Ù„Ù‰ 5,000 ÙƒÙˆÙŠÙ†", claimed: "ØªÙ… Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…"
    },
    en: {
        balanceLabel: "TOTAL BALANCE", energyLabel: "Energy", boostTitle: "Upgrades âš¡",
        tapName: "Multitap", tapDesc: "More coins per tap", energyName: "Energy Limit",
        energyDesc: "Increase max capacity", tasksTitle: "Tasks ðŸš€", refTitle: "Friends ðŸ‘¥",
        refDesc: "Earn 50,000 per friend!", navTap: "Tap", navBoost: "Boost", navTask: "Tasks", navRef: "Friends",
        shareBtn: "Share Link ðŸ”—", dailyTitle: "Daily Gift", dailyDesc: "Get 5,000 coins", claimed: "Claimed"
    }
};

function toggleLang() {
    currentLang = currentLang === 'ar' ? 'en' : 'ar';
    localStorage.setItem('lang', currentLang);
    updateUI();
}

function updateUI() {
    const l = langData[currentLang];
    document.body.style.direction = currentLang === 'ar' ? 'rtl' : 'ltr';
    document.getElementById('balance-label').innerText = l.balanceLabel;
    document.getElementById('energy-label').innerText = l.energyLabel;
    document.getElementById('boost-title').innerText = l.boostTitle;
    document.getElementById('tap-boost-name').innerText = l.tapName;
    document.getElementById('tap-boost-desc').innerText = l.tapDesc;
    document.getElementById('energy-boost-name').innerText = l.energyName;
    document.getElementById('energy-boost-desc').innerText = l.energyDesc;
    document.getElementById('tasks-title').innerText = l.tasksTitle;
    document.getElementById('ref-title').innerText = l.refTitle;
    document.getElementById('ref-desc').innerText = l.refDesc;
    document.getElementById('nav-tap').innerText = l.navTap;
    document.getElementById('nav-boost').innerText = l.navBoost;
    document.getElementById('nav-task').innerText = l.navTask;
    document.getElementById('nav-ref').innerText = l.navRef;
    document.getElementById('ref-btn-share').innerText = l.shareBtn;
    document.getElementById('daily-reward-title').innerText = l.dailyTitle;
    document.getElementById('daily-reward-desc').innerText = l.dailyDesc;

    document.getElementById('balance').innerText = Math.floor(userData.score).toLocaleString();
    document.getElementById('energy-txt').innerText = `${Math.floor(userData.energy)}/${userData.maxEnergy}`;
    document.getElementById('energy-fill').style.width = `${(userData.energy/userData.maxEnergy)*100}%`;
    document.getElementById('tap-price').innerText = (500 * (userData.upgrades.tap + 1)).toLocaleString();
    document.getElementById('energy-price').innerText = (1000 * (userData.upgrades.energy + 1)).toLocaleString();

    // ÙØ­Øµ Ø§Ù„Ù…ÙƒØ§ÙØ£Ø© Ø§Ù„ÙŠÙˆÙ…ÙŠØ©
    const now = Date.now();
    const canClaim = now - userData.lastClaim > 24 * 60 * 60 * 1000;
    const btn = document.getElementById('daily-btn');
    if(!canClaim) {
        btn.innerText = l.claimed;
        btn.disabled = true;
    } else {
        btn.innerText = currentLang === 'ar' ? 'Ø§Ø³ØªÙ„Ø§Ù…' : 'Claim';
        btn.disabled = false;
    }
}

// --- Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª ---
function handleTap(event) {
    if(userData.energy < userData.tapPower) return;
    if(tg.HapticFeedback) tg.HapticFeedback.impactOccurred('medium');

    userData.score += userData.tapPower;
    userData.energy -= userData.tapPower;
    updateUI();
    createTapEffect(event);
    saveData();
}

function createTapEffect(event) {
    const x = event.clientX || (event.touches ? event.touches[0].clientX : 0);
    const y = event.clientY || (event.touches ? event.touches[0].clientY : 0);
    const effect = document.createElement('div');
    effect.className = 'tap-effect';
    effect.innerText = `+${userData.tapPower}`;
    effect.style.left = `${x - 20}px`;
    effect.style.top = `${y - 40}px`;
    document.body.appendChild(effect);
    setTimeout(() => effect.remove(), 700);
}

function claimDaily() {
    userData.score += 5000;
    userData.lastClaim = Date.now();
    saveData();
    updateUI();
    alert(currentLang === 'ar' ? 'Ù…Ø¨Ø±ÙˆÙƒ! Ø§Ø³ØªÙ„Ù…Øª 5,000' : 'Congrats! You got 5,000');
}

function buyUpgrade(type) {
    let price = type === 'tap' ? 500 * (userData.upgrades.tap + 1) : 1000 * (userData.upgrades.energy + 1);
    if(userData.score >= price) {
        userData.score -= price;
        if(type === 'tap') {
            userData.tapPower += 1;
            userData.upgrades.tap += 1;
        } else {
            userData.maxEnergy += 500;
            userData.energy = userData.maxEnergy;
            userData.upgrades.energy += 1;
        }
        updateUI();
        saveData();
    }
}

setInterval(() => {
    if(userData.energy < userData.maxEnergy) {
        userData.energy = Math.min(userData.maxEnergy, userData.energy + 1);
        updateUI();
    }
}, 1000);

function saveData() { db.ref('users/'+uid).update(userData); }

function init() {
    db.ref('users/'+uid).on('value', (s) => {
        const d = s.val();
        if(d) { userData = {...userData, ...d}; updateUI(); }
        else { saveData(); }
    });
    document.getElementById('reflink').value = `https://t.me/MTM_Coin_App_bot?start=${uid}`;
}

function showP(id, el) {
    document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
    document.querySelectorAll('.nav-item').forEach(n=>n.classList.remove('active'));
    document.getElementById(id).classList.add('active');
    el.classList.add('active');
}

function shareRef() {
    const l = `https://t.me/MTM_Coin_App_bot?start=${uid}`;
    tg.openTelegramLink(`https://t.me/share/url?url=${encodeURIComponent(l)}&text=Join MTM!`);
}

init();
</script>
</body>
</html>
