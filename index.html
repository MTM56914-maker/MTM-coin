<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>MTM Coin - Ultimate Edition</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --gold: linear-gradient(135deg, #ffcc00, #ff9900);
            --bg: #050508;
            --card-bg: #121220;
            --accent: #ffcc00;
        }

        body {
            background: var(--bg); color: white; font-family: 'Segoe UI', sans-serif;
            margin: 0; overflow: hidden; -webkit-user-select: none; user-select: none;
            touch-action: manipulation; direction: rtl; -webkit-tap-highlight-color: transparent;
        }

        .header {
            padding: 15px; background: rgba(22, 22, 37, 0.8); backdrop-filter: blur(10px);
            display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #222;
        }

        #balance-container { text-align: center; margin: 20px 0; }
        #balance {
            font-size: 45px; font-weight: 900; background: var(--gold);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        }

        .coin-wrapper { position: relative; display: flex; justify-content: center; align-items: center; height: 240px; }
        #coin {
            width: 200px; height: 200px; cursor: pointer; border-radius: 50%;
            transition: transform 0.1s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            filter: drop-shadow(0 0 20px rgba(255, 204, 0, 0.3));
            -webkit-touch-callout: none;
        }
        #coin:active { transform: scale(0.90); }

        .tap-effect {
            position: absolute; color: #ffcc00; font-size: 26px; font-weight: bold;
            pointer-events: none; animation: floatUp 0.7s ease-out forwards; z-index: 100;
        }
        @keyframes floatUp { 0% { opacity: 1; transform: translateY(0); } 100% { opacity: 0; transform: translateY(-120px); } }

        .energy-bar-container { width: 85%; height: 10px; background: #222; border-radius: 10px; margin: 10px auto; overflow: hidden; }
        #energy-fill { height: 100%; width: 100%; background: var(--gold); transition: width 0.3s; }

        .page { display: none; padding: 20px; animation: fadeIn 0.3s; height: 75vh; overflow-y: auto; padding-bottom: 120px; }
        .page.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .card {
            background: var(--card-bg); padding: 12px; border-radius: 15px;
            margin-bottom: 10px; display: flex; align-items: center; border: 1px solid #222;
        }
        .info { flex-grow: 1; text-align: right; margin-right: 10px; }
        .rank-num { width: 30px; font-weight: bold; color: var(--accent); }

        .btn {
            background: var(--gold); color: #000; padding: 8px 16px; border-radius: 10px;
            font-weight: 800; border: none; cursor: pointer;
        }

        .nav-bar {
            position: fixed; bottom: 15px; left: 5%; width: 90%;
            display: flex; background: rgba(22, 22, 37, 0.95); backdrop-filter: blur(15px);
            border-radius: 20px; padding: 10px 0; border: 1px solid #333; z-index: 1000;
        }
        .nav-item { flex: 1; text-align: center; color: #666; font-size: 11px; }
        .nav-item.active { color: var(--accent); }

        #lang-btn { background: #222; color: gold; border: 1px solid gold; padding: 4px 10px; border-radius: 8px; font-size: 12px; }
    </style>
</head>
<body>

<div class="header">
    <div id="level-txt">Level: 1</div>
    <button id="lang-btn" onclick="toggleLang()">EN / Ø¹Ø±Ø¨ÙŠ</button>
</div>

<div class="content">
    <div id="game-page" class="page active">
        <div id="balance-container">
            <div id="balance-label" style="font-size:12px; color:#aaa;">Ø±ØµÙŠØ¯Ùƒ</div>
            <div id="balance">0</div>
        </div>
        <div class="coin-wrapper">
            <img src="coin.png" id="coin" onpointerdown="handleTap(event)" 
                 onerror="this.src='https://i.ibb.co/L1mP94w/mtm-coin.png'">
        </div>
        <div style="text-align: center;">
            <div style="margin-bottom: 5px;"><span id="energy-label">Ø§Ù„Ø·Ø§Ù‚Ø©</span>: <span id="energy-txt">1000/1000</span></div>
            <div class="energy-bar-container"><div id="energy-fill"></div></div>
            <button class="btn" id="daily-btn" style="margin-top:10px; width:80%;" onclick="claimDaily()">ğŸ Ù…ÙƒØ§ÙØ£Ø© ÙŠÙˆÙ…ÙŠØ©</button>
        </div>
    </div>

    <div id="leader-page" class="page">
        <h2 id="leader-title">Ø§Ù„Ù…ØªØµØ¯Ø±ÙˆÙ† ğŸ†</h2>
        <div id="leader-list">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
    </div>

    <div id="boost-page" class="page">
        <h2 id="boost-title">Ø§Ù„ØªØ·ÙˆÙŠØ±Ø§Øª âš¡</h2>
        <div class="card">
            <i class="fas fa-hand-pointer" style="color:gold"></i>
            <div class="info"><b id="t-n">Ù‚ÙˆØ© Ø§Ù„Ù†Ù‚Ø±Ø©</b><br><small id="t-d">Ø³Ø¹Ø±: <span id="tap-price">500</span></small></div>
            <button class="btn" onclick="buyUpgrade('tap')">Upgrade</button>
        </div>
        <div class="card">
            <i class="fas fa-battery-full" style="color:gold"></i>
            <div class="info"><b id="e-n">Ù…Ø®Ø²ÙˆÙ† Ø§Ù„Ø·Ø§Ù‚Ø©</b><br><small id="e-d">Ø³Ø¹Ø±: <span id="energy-price">1000</span></small></div>
            <button class="btn" onclick="buyUpgrade('energy')">Upgrade</button>
        </div>
    </div>

    <div id="tasks-page" class="page">
        <h2 id="tasks-title">Ø§Ù„Ù…Ù‡Ø§Ù… ğŸš€</h2>
        <div class="card">
            <i class="fab fa-telegram"></i>
            <div class="info"><b>Telegram Channel</b><br><small>+50,000</small></div>
            <button class="btn" onclick="doTask('tg', 50000, 'https://t.me/MTM_coin')">Go</button>
        </div>
    </div>
</div>

<div class="nav-bar">
    <div class="nav-item active" onclick="showP('game-page',this)"><i class="fas fa-coins"></i><br><span id="n-tap">Ù†Ù‚Ø±</span></div>
    <div class="nav-item" onclick="showP('leader-page',this)"><i class="fas fa-trophy"></i><br><span id="n-rank">ØªØ±ØªÙŠØ¨</span></div>
    <div class="nav-item" onclick="showP('boost-page',this)"><i class="fas fa-bolt"></i><br><span id="n-boost">ØªØ·ÙˆÙŠØ±</span></div>
    <div class="nav-item" onclick="showP('tasks-page',this)"><i class="fas fa-tasks"></i><br><span id="n-task">Ù…Ù‡Ø§Ù…</span></div>
</div>

<script>
// Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
const firebaseConfig = { apiKey: "AIzaSyA1Nnh0P7RdWH7EhBnaGkk6QUNeWRXPKt8", databaseURL: "https://mtm-coin-a52d9-default-rtdb.firebaseio.com" };
firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const tg = window.Telegram.WebApp;
tg.expand();

const uid = tg.initDataUnsafe.user ? tg.initDataUnsafe.user.id : "12345";
const uname = tg.initDataUnsafe.user ? (tg.initDataUnsafe.user.first_name) : "Player";

let userData = { score: 0, energy: 1000, maxEnergy: 1000, tapPower: 1, upgrades: { tap: 0, energy: 0 }, tasks: {}, lastDaily: 0 };
let currentLang = localStorage.getItem('lang') || 'ar';

const lang = {
    ar: { tap: "Ù†Ù‚Ø±", rank: "ØªØ±ØªÙŠØ¨", boost: "ØªØ·ÙˆÙŠØ±", task: "Ù…Ù‡Ø§Ù…", leader: "Ø§Ù„Ù…ØªØµØ¯Ø±ÙˆÙ† ğŸ†", daily: "ğŸ Ù…ÙƒØ§ÙØ£Ø© ÙŠÙˆÙ…ÙŠØ©" },
    en: { tap: "Tap", rank: "Rank", boost: "Boost", task: "Tasks", leader: "Leaderboard ğŸ†", daily: "ğŸ Daily Reward" }
};

function toggleLang() {
    currentLang = currentLang === 'ar' ? 'en' : 'ar';
    localStorage.setItem('lang', currentLang);
    updateUI();
}

function updateUI() {
    document.body.style.direction = currentLang === 'ar' ? 'rtl' : 'ltr';
    document.getElementById('n-tap').innerText = lang[currentLang].tap;
    document.getElementById('n-rank').innerText = lang[currentLang].rank;
    document.getElementById('n-boost').innerText = lang[currentLang].boost;
    document.getElementById('n-task').innerText = lang[currentLang].task;
    document.getElementById('leader-title').innerText = lang[currentLang].leader;
    document.getElementById('daily-btn').innerText = lang[currentLang].daily;
    
    document.getElementById('balance').innerText = Math.floor(userData.score).toLocaleString();
    document.getElementById('energy-txt').innerText = `${Math.floor(userData.energy)}/${userData.maxEnergy}`;
    document.getElementById('energy-fill').style.width = `${(userData.energy/userData.maxEnergy)*100}%`;
    document.getElementById('tap-price').innerText = (500 * (userData.upgrades.tap + 1)).toLocaleString();
    document.getElementById('energy-price').innerText = (1000 * (userData.upgrades.energy + 1)).toLocaleString();
}

// Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ
function loadLeaderboard() {
    db.ref('users').orderByChild('score').limitToLast(10).on('value', (snapshot) => {
        let list = [];
        snapshot.forEach(child => { list.push(child.val()); });
        list.reverse();
        
        let html = '';
        list.forEach((user, index) => {
            html += `<div class="card">
                <div class="rank-num">#${index+1}</div>
                <div class="info"><b>${user.username || 'Unknown'}</b></div>
                <div style="color:gold">${Math.floor(user.score).toLocaleString()}</div>
            </div>`;
        });
        document.getElementById('leader-list').innerHTML = html;
    });
}

function handleTap(e) {
    if(userData.energy < userData.tapPower) return;
    if(tg.HapticFeedback) tg.HapticFeedback.impactOccurred('light');

    userData.score += userData.tapPower;
    userData.energy -= userData.tapPower;
    
    // ØªØ£Ø«ÙŠØ± Ø§Ù„Ù†Øµ
    const x = e.clientX || e.touches[0].clientX;
    const y = e.clientY || e.touches[0].clientY;
    const div = document.createElement('div');
    div.className = 'tap-effect';
    div.innerText = `+${userData.tapPower}`;
    div.style.left = x + 'px'; div.style.top = y + 'px';
    document.body.appendChild(div);
    setTimeout(() => div.remove(), 700);

    updateUI();
    saveData();
}

function buyUpgrade(type) {
    let price = type === 'tap' ? 500 * (userData.upgrades.tap + 1) : 1000 * (userData.upgrades.energy + 1);
    if(userData.score >= price) {
        userData.score -= price;
        if(type === 'tap') { userData.tapPower++; userData.upgrades.tap++; }
        else { userData.maxEnergy += 500; userData.upgrades.energy++; }
        saveData(); updateUI();
    }
}

function claimDaily() {
    const now = Date.now();
    if(now - userData.lastDaily > 86400000) {
        userData.score += 5000;
        userData.lastDaily = now;
        saveData(); updateUI();
        alert("Success! +5,000");
    } else {
        alert("Wait 24h!");
    }
}

function saveData() { db.ref('users/'+uid).update({ ...userData, username: uname }); }

function init() {
    db.ref('users/'+uid).on('value', (s) => {
        if(s.val()) { userData = {...userData, ...s.val()}; updateUI(); }
        else { saveData(); }
    });
    loadLeaderboard();
}

function showP(id, el) {
    document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
    document.querySelectorAll('.nav-item').forEach(n=>n.classList.remove('active'));
    document.getElementById(id).classList.add('active'); el.classList.add('active');
}

function doTask(t, r, l) {
    tg.openLink(l);
    setTimeout(() => {
        if(!userData.tasks[t]) {
            userData.score += r; userData.tasks[t] = true;
            saveData(); updateUI();
        }
    }, 4000);
}

init();
</script>
</body>
</html>
