<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>MTM Coin - Official App</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --gold: linear-gradient(135deg, #ffcc00, #ff9900); --bg: #050508; --card: #121220; --accent: #ffcc00; }
        body { background: var(--bg); color: white; font-family: 'Segoe UI', sans-serif; margin: 0; overflow: hidden; -webkit-tap-highlight-color: transparent; user-select: none; direction: rtl; }
        
        #lang-overlay { position: fixed; inset: 0; background: rgba(5,5,8,0.98); z-index: 10000; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 20px; }
        
        .header { padding: 15px; background: var(--card); display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #222; }
        .content { height: 75vh; overflow-y: auto; padding-bottom: 100px; scrollbar-width: none; }
        .content::-webkit-scrollbar { display: none; }

        #balance-container { text-align: center; padding: 15px 0; }
        #balance { font-size: 50px; font-weight: 900; background: var(--gold); -webkit-background-clip: text; -webkit-text-fill-color: transparent; text-shadow: 0 10px 20px rgba(255,204,0,0.2); }
        
        .coin-wrapper { position: relative; display: flex; justify-content: center; align-items: center; height: 220px; margin: 10px 0; }
        #coin { width: 190px; height: 190px; cursor: pointer; transition: transform 0.1s; border-radius: 50%; object-fit: contain; z-index: 10; }
        .coin-glow { position: absolute; width: 180px; height: 180px; background: var(--gold); filter: blur(50px); opacity: 0.3; border-radius: 50%; z-index: 1; }
        #coin:active { transform: scale(0.92); }
        
        .league-badge { background: #1a1a2e; padding: 5px 15px; border-radius: 20px; font-size: 12px; border: 1px solid #333; margin-top: 5px; display: inline-block; color: gold; }

        .nav-bar { position: fixed; bottom: 0; width: 100%; background: #0a0a15; display: flex; border-top: 1px solid #333; padding: 12px 0; z-index: 900; border-radius: 20px 20px 0 0; }
        .nav-item { flex: 1; text-align: center; color: #555; font-size: 11px; cursor: pointer; transition: 0.3s; }
        .nav-item.active { color: var(--accent); transform: translateY(-5px); }
        .nav-item i { font-size: 24px; margin-bottom: 4px; }

        .page { display: none; padding: 20px; animation: slideUp 0.4s ease; }
        .page.active { display: block; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        .card { background: var(--card); padding: 15px; border-radius: 18px; margin-bottom: 12px; display: flex; align-items: center; border: 1px solid #222; }
        .card-info { flex-grow: 1; margin: 0 15px; }
        .btn-action { background: var(--gold); color: black; border: none; padding: 10px 18px; border-radius: 12px; font-weight: bold; cursor: pointer; }
        
        .energy-status { width: 85%; height: 14px; background: #1a1a2a; border-radius: 10px; margin: 10px auto; overflow: hidden; border: 1px solid #333; position: relative; }
        #energy-fill { height: 100%; background: var(--gold); width: 100%; transition: width 0.3s; }
        
        .tap-pop { position: absolute; color: white; font-size: 32px; font-weight: 900; pointer-events: none; animation: float 0.8s ease-out forwards; z-index: 1000; text-shadow: 0 0 10px gold; }
        @keyframes float { 0% { opacity: 1; transform: translateY(0) scale(1); } 100% { opacity: 0; transform: translateY(-120px) scale(1.5); } }

        /* Ø³ØªØ§ÙŠÙ„ Ø§Ù„Ù…ÙƒØ§ÙØ£Ø© Ø§Ù„ÙŠÙˆÙ…ÙŠØ© */
        #daily-claim-section { background: rgba(255, 204, 0, 0.1); border: 1px dashed gold; padding: 15px; border-radius: 15px; text-align: center; margin-bottom: 20px; }
    </style>
</head>
<body>

<div id="lang-overlay">
    <img src="coin.png" style="width: 80px; margin-bottom: 10px;">
    <h2 style="color:gold; margin:0;">MTM COIN</h2>
    <button class="btn-action" style="width:220px; margin-top:20px;" onclick="setLanguage('ar')">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</button>
    <button class="btn-action" style="width:220px" onclick="setLanguage('en')">English</button>
</div>

<div class="header">
    <div onclick="showLangSelect()"><i class="fas fa-globe" style="color:gold; font-size:20px;"></i></div>
    <div style="text-align: center;">
        <div id="u-name" style="font-weight: bold; color: white;">Loading...</div>
        <div id="league-name" class="league-badge">Bronze League</div>
    </div>
    <div id="u-id" style="font-size: 10px; color: #555;">ID: 000</div>
</div>

<div class="content">
    <div id="page-tap" class="page active">
        <div id="balance-container">
            <small id="txt-balance-label" style="color:#888;">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø±ØµÙŠØ¯</small>
            <div id="balance">0</div>
        </div>
        
        <div class="coin-wrapper">
            <div class="coin-glow"></div>
            <img src="coin.png" id="coin" alt="MTM" onerror="this.src='https://cdn-icons-png.flaticon.com/512/217/217853.png'">
        </div>

        <div style="text-align: center; margin-top:20px">
            <div style="font-size:18px; font-weight: bold; margin-bottom:5px;">âš¡ <span id="energy-val">1000/1000</span></div>
            <div class="energy-status"><div id="energy-fill"></div></div>
        </div>
    </div>

    <div id="page-boost" class="page">
        <div id="daily-claim-section">
            <h3 id="daily-title" style="margin:0; color:gold;">Ø§Ù„Ù…ÙƒØ§ÙØ£Ø© Ø§Ù„ÙŠÙˆÙ…ÙŠØ© ğŸ</h3>
            <p id="daily-desc" style="font-size:12px; color:#ccc;">Ø¹Ø¯ ÙƒÙ„ 24 Ø³Ø§Ø¹Ø© Ù„Ø·Ù„Ø¨ 5,000 Ù‚Ø·Ø¹Ø©</p>
            <button class="btn-action" id="btn-daily-claim" onclick="claimDaily()">Claim Bonus</button>
        </div>
        <h2 id="txt-boost-head">Ø§Ù„ØªØ·ÙˆÙŠØ±Ø§Øª âš¡</h2>
        <div class="card">
            <i class="fas fa-hand-pointer" style="color:gold; font-size:24px"></i>
            <div class="card-info"><b id="txt-multitap">Ù‚ÙˆØ© Ø§Ù„Ù†Ù‚Ø±Ø©</b><br><small id="lv-tap">Level 1</small></div>
            <button class="btn-action" id="btn-up-tap" onclick="buyUpgrade('tap')">500</button>
        </div>
        <div class="card">
            <i class="fas fa-battery-full" style="color:gold; font-size:24px"></i>
            <div class="card-info"><b id="txt-energy-limit">Ø³Ø¹Ø© Ø§Ù„Ø·Ø§Ù‚Ø©</b><br><small id="lv-energy">Level 1</small></div>
            <button class="btn-action" id="btn-up-energy" onclick="buyUpgrade('energy')">1000</button>
        </div>
    </div>

    <div id="page-task" class="page">
        <h2 id="txt-task-head">Ø§Ù„Ù…Ù‡Ø§Ù… ğŸš€</h2>
        <div class="card">
            <i class="fab fa-telegram" style="font-size:24px; color:#0088cc"></i>
            <div class="card-info"><b>Telegram Channel</b><br><small>+50,000</small></div>
            <button class="btn-action" id="btn-task-tg" onclick="doTask('tg', 50000, 'https://t.me/MTM_coin')">Go</button>
        </div>
    </div>

    <div id="page-rank" class="page">
        <h2 id="txt-rank-head">Ø§Ù„Ù…ØªØµØ¯Ø±ÙˆÙ† ğŸ†</h2>
        <div id="rank-list">Loading...</div>
    </div>

    <div id="page-ref" class="page">
        <h2 id="txt-ref-head">Ø§Ù„Ø£ØµØ¯Ù‚Ø§Ø¡ ğŸ‘¥</h2>
        <div class="card" style="flex-direction: column; gap:15px; padding:25px;">
            <p id="txt-ref-desc">Ø§Ø­ØµÙ„ Ø¹Ù„Ù‰ 50,000 ÙÙˆØ±ÙŠØ© + 10% Ù…Ù† Ù†Ù‚Ø±Ø§Øª Ø£ØµØ¯Ù‚Ø§Ø¦Ùƒ!</p>
            <input type="text" id="ref-link" readonly style="width:100%; padding:12px; background:#000; border:1px solid #444; color:gold; border-radius:10px; text-align:center;">
            <button class="btn-action" style="width:100%" onclick="copyLink()">Copy Link</button>
        </div>
    </div>
</div>

<div class="nav-bar">
    <div class="nav-item active" onclick="showPage('page-tap', this)"><i class="fas fa-coins"></i><br><span id="n-tap">ØªØ¹Ø¯ÙŠÙ†</span></div>
    <div class="nav-item" onclick="showPage('page-boost', this)"><i class="fas fa-bolt"></i><br><span id="n-boost">ØªØ·ÙˆÙŠØ±</span></div>
    <div class="nav-item" onclick="showPage('page-task', this)"><i class="fas fa-tasks"></i><br><span id="n-task">Ù…Ù‡Ø§Ù…</span></div>
    <div class="nav-item" onclick="showPage('page-rank', this); updateRank();"><i class="fas fa-trophy"></i><br><span id="n-rank">ØªØ±ØªÙŠØ¨</span></div>
    <div class="nav-item" onclick="showPage('page-ref', this)"><i class="fas fa-users"></i><br><span id="n-ref">Ø¥Ø­Ø§Ù„Ø©</span></div>
</div>

<script>
// Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase
const firebaseConfig = { 
    apiKey: "AIzaSyA1Nnh0P7RdWH7EhBnaGkk6QUNeWRXPKt8", 
    databaseURL: "https://mtm-coin-a52d9-default-rtdb.firebaseio.com" 
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const tg = window.Telegram.WebApp;
tg.expand();

// Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù„Ø§Ø¹Ø¨ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
const userId = tg.initDataUnsafe.user ? tg.initDataUnsafe.user.id : "user_local";
const userName = tg.initDataUnsafe.user ? tg.initDataUnsafe.user.first_name : "Player";
const referrerId = new URLSearchParams(window.location.search).get('start');

let user = {
    score: 0, energy: 1000, maxE: 1000, 
    tap: 1, upT: 0, upE: 0, 
    tasks: { tg: false },
    name: userName,
    lastClaim: 0,
    referredBy: referrerId || null
};

let canSave = false;

// ÙˆØ¸ÙŠÙØ© Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª + Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù€ 10% Ù„Ù„Ù…Ø¯Ø¹Ùˆ
function saveUser() {
    if (!canSave) return;
    db.ref('users/' + userId).update(user);
    
    // Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Ø´Ø®Øµ Ø¯Ø¹Ø§ Ù‡Ø°Ø§ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ØŒ Ù†Ø±Ø³Ù„ Ù„Ù‡ 10% Ù…Ù† Ù‚ÙŠÙ…Ø© Ø§Ù„Ù†Ù‚Ø±Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
    if (user.referredBy && user.referredBy !== userId) {
        let bonus = user.tap * 0.1; 
        db.ref('users/' + user.referredBy + '/score').transaction((currentScore) => {
            return (currentScore || 0) + bonus;
        });
    }
}

// ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù†Ø¯ Ø§Ù„Ø¨Ø¯Ø¡
db.ref('users/' + userId).once('value', (snap) => {
    if (snap.exists()) {
        user = { ...user, ...snap.val() };
    } else {
        // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯Ø§Ù‹ ÙˆØ¬Ø§Ø¡ Ø¹Ø¨Ø± Ø±Ø§Ø¨Ø· Ø¥Ø­Ø§Ù„Ø©ØŒ Ù†Ø¹Ø·ÙŠ Ø§Ù„Ø¯Ø§Ø¹ÙŠ Ù…ÙƒØ§ÙØ£Ø© Ø¯Ø®ÙˆÙ„ 50 Ø£Ù„Ù
        if (user.referredBy) {
            db.ref('users/' + user.referredBy + '/score').transaction((s) => (s || 0) + 50000);
        }
        db.ref('users/' + userId).set(user);
    }
    canSave = true;
    checkDailyStatus();
    applyLang();
});

// Ø§Ù„Ù…ÙƒØ§ÙØ£Ø© Ø§Ù„ÙŠÙˆÙ…ÙŠØ©
function checkDailyStatus() {
    const now = Date.now();
    const btn = document.getElementById('btn-daily-claim');
    if (now - user.lastClaim < 24 * 60 * 60 * 1000) {
        btn.disabled = true;
        btn.innerText = "Wait for tomorrow";
        btn.style.background = "#444";
    }
}

function claimDaily() {
    const now = Date.now();
    if (now - user.lastClaim >= 24 * 60 * 60 * 1000) {
        user.score += 5000;
        user.lastClaim = now;
        updateUI();
        saveUser();
        checkDailyStatus();
        tg.showAlert("ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… 5,000 Ù‚Ø·Ø¹Ø© Ø¨Ù†Ø¬Ø§Ø­! ğŸ");
    }
}

// Ù†Ø¸Ø§Ù… Ø§Ù„Ù†Ù‚Ø±Ø§Øª
document.getElementById('coin').addEventListener('pointerdown', (e) => {
    if (!canSave || user.energy < user.tap) return;
    user.score += user.tap;
    user.energy -= user.tap;
    
    let pop = document.createElement('div');
    pop.className = 'tap-pop';
    pop.innerText = "+" + user.tap;
    pop.style.left = (e.clientX - 20) + "px";
    pop.style.top = (e.clientY - 40) + "px";
    document.body.appendChild(pop);
    setTimeout(() => pop.remove(), 800);
    
    if(tg.HapticFeedback) tg.HapticFeedback.impactOccurred('light');
    updateUI();
});

// ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
function updateUI() {
    document.getElementById('balance').innerText = Math.floor(user.score).toLocaleString();
    document.getElementById('energy-val').innerText = `${Math.floor(user.energy)}/${user.maxE}`;
    document.getElementById('energy-fill').style.width = (user.energy / user.maxE * 100) + "%";
    document.getElementById('u-name').innerText = user.name;
    document.getElementById('u-id').innerText = "ID: " + userId;
    document.getElementById('lv-tap').innerText = "Level " + (user.upT + 1);
    document.getElementById('lv-energy').innerText = "Level " + (user.upE + 1);
    document.getElementById('btn-up-tap').innerText = (500 * (user.upT + 1));
    document.getElementById('btn-up-energy').innerText = (1000 * (user.upE + 1));
    document.getElementById('ref-link').value = `https://t.me/MTM_Coin_App_bot?start=${userId}`;
    
    let league = "Bronze";
    if(user.score > 50000) league = "Silver";
    if(user.score > 250000) league = "Gold";
    document.getElementById('league-name').innerText = league + " League";
}

// Ø§Ù„ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©
function showPage(p, el) {
    document.querySelectorAll('.page').forEach(x => x.classList.remove('active'));
    document.querySelectorAll('.nav-item').forEach(x => x.classList.remove('active'));
    document.getElementById(p).classList.add('active');
    el.classList.add('active');
}

setInterval(saveUser, 5000); // Ø­ÙØ¸ ÙƒÙ„ 5 Ø«ÙˆØ§Ù†ÙŠ ÙˆØªØ­Ø¯ÙŠØ« Ø¹Ù…ÙˆÙ„Ø© Ø§Ù„Ø£ØµØ¯Ù‚Ø§Ø¡

// Ø§Ù„ØªØ±Ø¬Ù…Ø© ÙˆØ§Ù„Ù„ØºØ©
const langData = {
    ar: { bLabel:"Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø±ØµÙŠØ¯", n1:"ØªØ¹Ø¯ÙŠÙ†", n2:"ØªØ·ÙˆÙŠØ±", n3:"Ù…Ù‡Ø§Ù…", n4:"ØªØ±ØªÙŠØ¨", n5:"Ø¥Ø­Ø§Ù„Ø©" },
    en: { bLabel:"Total Balance", n1:"Tap", n2:"Boost", n3:"Tasks", n4:"Rank", n5:"Ref" }
};
let currentLang = localStorage.getItem('lang') || 'ar';
function setLanguage(l) { currentLang = l; localStorage.setItem('lang', l); document.getElementById('lang-overlay').style.display = 'none'; applyLang(); }
function applyLang() {
    const l = langData[currentLang];
    document.getElementById('txt-balance-label').innerText = l.bLabel;
    document.getElementById('n-tap').innerText = l.n1; document.getElementById('n-boost').innerText = l.n2;
    document.getElementById('n-task').innerText = l.n3; document.getElementById('n-rank').innerText = l.n4;
    document.getElementById('n-ref').innerText = l.n5;
    updateUI();
}
function showLangSelect() { document.getElementById('lang-overlay').style.display = 'flex'; }
function copyLink() { const i = document.getElementById('ref-link'); i.select(); navigator.clipboard.writeText(i.value); tg.showAlert("ØªÙ… Ø§Ù„Ù†Ø³Ø®!"); }

// Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø·Ø§Ù‚Ø©
setInterval(() => {
    if(canSave && user.energy < user.maxE) {
        user.energy = Math.min(user.maxE, user.energy + 3);
        updateUI();
    }
}, 1000);
</script>
</body>
</html>
