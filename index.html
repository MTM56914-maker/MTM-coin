<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>MTM Coin - Ultimate Edition</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --gold: linear-gradient(135deg, #ffcc00, #ff9900);
            --bg: #050508;
            --card-bg: #121220;
            --accent: #ffcc00;
        }

        body {
            background: var(--bg); color: white; font-family: 'Segoe UI', sans-serif;
            margin: 0; overflow: hidden; direction: rtl;
            -webkit-tap-highlight-color: transparent; /* Ù…Ù†Ø¹ Ø§Ù„Ù…Ø±Ø¨Ø¹ Ø§Ù„Ø£Ø²Ø±Ù‚ */
            user-select: none; -webkit-user-select: none;
        }

        /* Header */
        .header {
            padding: 15px; background: rgba(22, 22, 37, 0.8);
            display: flex; justify-content: space-between; align-items: center;
        }

        /* Stats */
        #balance-container { text-align: center; margin: 20px 0; }
        #balance { font-size: 40px; font-weight: 900; background: var(--gold); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }

        /* Coin Area */
        .coin-wrapper { position: relative; display: flex; justify-content: center; align-items: center; height: 250px; }
        #coin {
            width: 200px; height: 200px; cursor: pointer;
            transition: transform 0.1s; border-radius: 50%;
            box-shadow: 0 0 30px rgba(255, 204, 0, 0.2);
        }
        #coin:active { transform: scale(0.95); }

        .tap-effect {
            position: absolute; color: gold; font-size: 24px; font-weight: bold;
            pointer-events: none; animation: floatUp 0.6s ease-out forwards;
        }
        @keyframes floatUp { 0% { opacity: 1; transform: translateY(0); } 100% { opacity: 0; transform: translateY(-100px); } }

        /* Navigation */
        .nav-bar {
            position: fixed; bottom: 0; width: 100%; height: 70px;
            background: #121220; display: flex; border-top: 1px solid #333;
        }
        .nav-item { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; color: #666; font-size: 12px; }
        .nav-item.active { color: var(--accent); }

        /* Pages */
        .page { display: none; padding: 20px; height: calc(100vh - 160px); overflow-y: auto; }
        .page.active { display: block; }

        .card {
            background: var(--card-bg); padding: 15px; border-radius: 12px;
            margin-bottom: 10px; border: 1px solid #222; display: flex; align-items: center;
        }
        .card i { font-size: 20px; margin-left: 15px; color: gold; }
        .btn { background: var(--gold); border: none; padding: 7px 15px; border-radius: 8px; font-weight: bold; }

        /* Leaderboard Style */
        .rank-item { display: flex; justify-content: space-between; padding: 10px; border-bottom: 1px solid #222; }
        .rank-index { color: gold; width: 30px; }
        .rank-name { flex-grow: 1; }
    </style>
</head>
<body>

    <div class="header">
        <span id="username">Ù„Ø§Ø¹Ø¨..</span>
        <div id="energy-text">âš¡ <span id="energy-val">1000</span></div>
    </div>

    <div id="main-page" class="page active">
        <div id="balance-container">
            <div id="balance">0</div>
            <div style="font-size: 14px; color: #aaa;">Ø±ØµÙŠØ¯Ùƒ Ù…Ù† MTM</div>
        </div>
        <div class="coin-wrapper">
            <img id="coin" src="https://cdn-icons-png.flaticon.com/512/217/217853.png" alt="Coin">
        </div>
        <div style="width: 80%; background: #222; height: 8px; margin: 20px auto; border-radius: 5px;">
            <div id="energy-fill" style="width: 100%; height: 100%; background: gold; border-radius: 5px;"></div>
        </div>
    </div>

    <div id="leaderboard-page" class="page">
        <h2>ğŸ† Ø§Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠ</h2>
        <div id="rankings-list">ØªØ­Ù…ÙŠÙ„...</div>
    </div>

    <div id="ref-page" class="page">
        <h2>ğŸ‘¥ Ø¯Ø¹ÙˆØ© Ø§Ù„Ø£ØµØ¯Ù‚Ø§Ø¡</h2>
        <div class="card">
            <div class="info">
                <h3>Ø±Ø§Ø¨Ø· Ø§Ù„Ø¥Ø­Ø§Ù„Ø© Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ</h3>
                <p id="ref-link" style="font-size: 11px; color: gold;"></p>
                <button class="btn" onclick="copyRef()">Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø·</button>
            </div>
        </div>
        <p>ØªØ­ØµÙ„ Ø¹Ù„Ù‰ 5000 Ø¹Ù…Ù„Ø© Ø¹Ù† ÙƒÙ„ ØµØ¯ÙŠÙ‚ ÙŠØ¯Ø®Ù„ Ù…Ù† Ø®Ù„Ø§Ù„Ùƒ!</p>
    </div>

    <div class="nav-bar">
        <div class="nav-item active" onclick="showPage('main-page', this)"><i class="fas fa-coins"></i><span>ØªØ¹Ø¯ÙŠÙ†</span></div>
        <div class="nav-item" onclick="showPage('leaderboard-page', this); updateLeaderboard()"><i class="fas fa-trophy"></i><span>Ø§Ù„ØªØ±ØªÙŠØ¨</span></div>
        <div class="nav-item" onclick="showPage('ref-page', this)"><i class="fas fa-user-plus"></i><span>Ø¥Ø­Ø§Ù„Ø©</span></div>
    </div>

    <script>
        // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase
        const firebaseConfig = {
            apiKey: "AIzaSy...",
            databaseURL: "https://mtm-coin-a52d9-default-rtdb.firebaseio.com"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        const tg = window.Telegram.WebApp;
        tg.expand();
        const uid = tg.initDataUnsafe.user ? tg.initDataUnsafe.user.id : "123456";
        const uname = tg.initDataUnsafe.user ? tg.initDataUnsafe.user.first_name : "Guest";

        let score = 0;
        let energy = 1000;
        let power = 1;

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        db.ref('users/' + uid).once('value', (s) => {
            const data = s.val();
            if(data) {
                score = data.score || 0;
                energy = data.energy || 1000;
                power = data.power || 1;
            } else {
                db.ref('users/' + uid).set({ score: 0, energy: 1000, name: uname });
            }
            updateUI();
        });

        // Ø§Ù„Ù†Ù‚Ø±
        document.getElementById('coin').addEventListener('click', (e) => {
            if(energy >= power) {
                score += power;
                energy -= power;
                createEffect(e);
                updateUI();
                saveData();
            } else {
                tg.HapticFeedback.notificationOccurred('error');
            }
        });

        function updateUI() {
            document.getElementById('balance').innerText = score.toLocaleString();
            document.getElementById('energy-val').innerText = energy;
            document.getElementById('energy-fill').style.width = (energy / 10) + "%";
            document.getElementById('username').innerText = uname;
            document.getElementById('ref-link').innerText = `https://t.me/YourBotName?start=${uid}`;
        }

        function createEffect(e) {
            const effect = document.createElement('div');
            effect.className = 'tap-effect';
            effect.innerText = "+" + power;
            effect.style.left = e.pageX + "px";
            effect.style.top = e.pageY + "px";
            document.body.appendChild(effect);
            setTimeout(() => effect.remove(), 600);
        }

        function showPage(id, el) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            el.classList.add('active');
        }

        // Ø§Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ
        function updateLeaderboard() {
            const list = document.getElementById('rankings-list');
            list.innerHTML = "Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...";
            db.ref('users').orderByChild('score').limitToLast(10).once('value', (s) => {
                list.innerHTML = "";
                let players = [];
                s.forEach(child => { players.push(child.val()); });
                players.reverse().forEach((p, i) => {
                    list.innerHTML += `
                        <div class="rank-item">
                            <span class="rank-index">#${i+1}</span>
                            <span class="rank-name">${p.name || 'Ù„Ø§Ø¹Ø¨'}</span>
                            <span class="rank-score">${p.score.toLocaleString()}</span>
                        </div>
                    `;
                });
            });
        }

        function copyRef() {
            const link = document.getElementById('ref-link').innerText;
            navigator.clipboard.writeText(link);
            tg.showAlert("ØªÙ… Ù†Ø³Ø® Ø±Ø§Ø¨Ø· Ø§Ù„Ø¥Ø­Ø§Ù„Ø©!");
        }

        function saveData() {
            db.ref('users/' + uid).update({ score: score, energy: energy, name: uname });
        }

        // ØªØ¬Ø¯Ø¯ Ø§Ù„Ø·Ø§Ù‚Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
        setInterval(() => {
            if(energy < 1000) {
                energy += 1;
                updateUI();
            }
        }, 1500);
    </script>
</body>
</html>
