<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>MTM Coin - Official App</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --gold: linear-gradient(135deg, #ffcc00, #ff9900); --bg: #050508; --card: #121220; --accent: #ffcc00; }
        body { background: var(--bg); color: white; font-family: 'Segoe UI', sans-serif; margin: 0; overflow: hidden; -webkit-tap-highlight-color: transparent; user-select: none; direction: rtl; }
        
        #lang-overlay { position: fixed; inset: 0; background: rgba(5,5,8,0.98); z-index: 10000; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 20px; }
        .header { padding: 15px; background: var(--card); display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #222; }
        .content { height: 75vh; overflow-y: auto; padding-bottom: 100px; scrollbar-width: none; }
        #balance { font-size: 45px; font-weight: 900; background: var(--gold); -webkit-background-clip: text; -webkit-text-fill-color: transparent; text-align: center; margin: 10px 0; }
        
        .coin-wrapper { position: relative; display: flex; justify-content: center; align-items: center; height: 210px; }
        #coin { width: 180px; height: 180px; cursor: pointer; transition: transform 0.1s; border-radius: 50%; z-index: 10; box-shadow: 0 0 20px rgba(255, 204, 0, 0.2); }
        #coin:active { transform: scale(0.92); }
        
        .nav-bar { position: fixed; bottom: 0; width: 100%; background: #0a0a15; display: flex; border-top: 1px solid #333; padding: 12px 0; z-index: 900; }
        .nav-item { flex: 1; text-align: center; color: #555; font-size: 11px; cursor: pointer; }
        .nav-item.active { color: var(--accent); }
        .nav-item i { font-size: 22px; margin-bottom: 4px; }

        .page { display: none; padding: 20px; animation: fadeIn 0.3s ease; }
        .page.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .card { background: var(--card); padding: 15px; border-radius: 15px; margin-bottom: 12px; display: flex; align-items: center; border: 1px solid #222; }
        .card-info { flex-grow: 1; margin: 0 15px; }
        .btn-action { background: var(--gold); color: black; border: none; padding: 10px 15px; border-radius: 10px; font-weight: bold; cursor: pointer; }
        .btn-action:disabled { background: #444; color: #888; cursor: not-allowed; }
        
        .energy-status { width: 80%; height: 12px; background: #1a1a2a; border-radius: 10px; margin: 10px auto; overflow: hidden; border: 1px solid #333; }
        #energy-fill { height: 100%; background: var(--gold); width: 100%; transition: width 0.3s; }
        
        .tap-pop { position: absolute; color: white; font-size: 28px; font-weight: bold; pointer-events: none; animation: float 0.7s forwards; z-index: 1000; text-shadow: 0 0 5px gold; }
        @keyframes float { 0% { opacity: 1; transform: translateY(0); } 100% { opacity: 0; transform: translateY(-100px); } }
        
        /* Rank Styles */
        .rank-item { display: flex; align-items: center; background: #161625; padding: 12px; border-radius: 12px; margin-bottom: 8px; border: 1px solid #222; }
        .rank-num { width: 30px; font-weight: bold; color: gold; }
        .rank-name { flex-grow: 1; margin: 0 10px; font-size: 14px; }
        .rank-score { color: #00ff88; font-weight: bold; }
    </style>
</head>
<body>

<div id="lang-overlay">
    <h2 style="color:gold;">MTM COIN</h2>
    <button class="btn-action" style="width:200px" onclick="setLanguage('ar')">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</button>
    <button class="btn-action" style="width:200px; margin-top:10px" onclick="setLanguage('en')">English</button>
</div>

<div class="header">
    <i class="fas fa-globe" style="color:gold; font-size:18px;" onclick="showLangSelect()"></i>
    <div style="text-align:center">
        <div id="u-name" style="font-weight:bold">Loading...</div>
        <div id="league-name" style="color:gold; font-size:12px;">Bronze</div>
    </div>
    <div id="u-id" style="font-size:10px; color:#555">ID: 000</div>
</div>

<div class="content">
    <div id="page-tap" class="page active">
        <div style="text-align:center; color:#888; font-size:12px; margin-top:10px;" id="txt-balance-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø±ØµÙŠØ¯</div>
        <div id="balance">0</div>
        <div class="coin-wrapper">
            <img src="https://cdn-icons-png.flaticon.com/512/217/217853.png" id="coin">
        </div>
        <div style="text-align:center; margin-top:20px">
            <div style="font-size:16px">âš¡ <span id="energy-val">1000/1000</span></div>
            <div class="energy-status"><div id="energy-fill"></div></div>
        </div>
    </div>

    <div id="page-boost" class="page">
        <div class="card" style="background:rgba(255,204,0,0.1); border:1px dashed gold">
            <div class="card-info"><b>Ø§Ù„Ù…ÙƒØ§ÙØ£Ø© Ø§Ù„ÙŠÙˆÙ…ÙŠØ© ğŸ</b><br><small>+5,000 Ù‚Ø·Ø¹Ø©</small></div>
            <button class="btn-action" id="btn-daily-claim" onclick="claimDaily()">Claim</button>
        </div>
        <h2 id="txt-boost-head">Ø§Ù„ØªØ·ÙˆÙŠØ±Ø§Øª âš¡</h2>
        <div class="card">
            <i class="fas fa-hand-pointer" style="color:gold; font-size:20px"></i>
            <div class="card-info"><b id="txt-multitap">Ù‚ÙˆØ© Ø§Ù„Ù†Ù‚Ø±Ø©</b><br><small id="lv-tap">Level 1</small></div>
            <button class="btn-action" id="btn-up-tap" onclick="buyUpgrade('tap')">500</button>
        </div>
        <div class="card">
            <i class="fas fa-battery-full" style="color:gold; font-size:20px"></i>
            <div class="card-info"><b id="txt-energy-limit">Ø³Ø¹Ø© Ø§Ù„Ø·Ø§Ù‚Ø©</b><br><small id="lv-energy">Level 1</small></div>
            <button class="btn-action" id="btn-up-energy" onclick="buyUpgrade('energy')">1000</button>
        </div>
    </div>

    <div id="page-rank" class="page">
        <h2 id="txt-rank-head" style="text-align:center;">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ØªØµØ¯Ø±ÙŠÙ† ğŸ†</h2>
        <div id="rank-list" style="margin-top:20px;">
            </div>
    </div>

    <div id="page-task" class="page"><h2 id="txt-task-head">Ø§Ù„Ù…Ù‡Ø§Ù… ğŸš€</h2><div id="task-list"></div></div>
    <div id="page-ref" class="page">
        <h2 id="txt-ref-head">Ø§Ù„Ø£ØµØ¯Ù‚Ø§Ø¡ ğŸ‘¥</h2>
        <div class="card" style="flex-direction:column; gap:15px;">
            <p id="txt-ref-desc" style="text-align:center">Ø§Ø±Ø¨Ø­ Ù…Ù† Ø¯Ø¹ÙˆØ© Ø§Ù„Ø£ØµØ¯Ù‚Ø§Ø¡</p>
            <input type="text" id="ref-link" readonly style="width:100%; background:#000; border:1px solid #333; color:gold; text-align:center; padding:10px;">
            <button class="btn-action" style="width:100%" onclick="copyLink()">Copy Link</button>
        </div>
    </div>
</div>

<div class="nav-bar">
    <div class="nav-item active" onclick="showPage('page-tap', this)"><i class="fas fa-coins"></i><br><span id="n-tap">ØªØ¹Ø¯ÙŠÙ†</span></div>
    <div class="nav-item" onclick="showPage('page-boost', this)"><i class="fas fa-bolt"></i><br><span id="n-boost">ØªØ·ÙˆÙŠØ±</span></div>
    <div class="nav-item" onclick="showPage('page-rank', this); updateRank();"><i class="fas fa-trophy"></i><br><span id="n-rank">ØªØ±ØªÙŠØ¨</span></div>
    <div class="nav-item" onclick="showPage('page-ref', this)"><i class="fas fa-users"></i><br><span id="n-ref">Ø¥Ø­Ø§Ù„Ø©</span></div>
</div>

<script>
// Firebase Setup
const firebaseConfig = { 
    apiKey: "AIzaSyA1Nnh0P7RdWH7EhBnaGkk6QUNeWRXPKt8", 
    databaseURL: "https://mtm-coin-a52d9-default-rtdb.firebaseio.com" 
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const tg = window.Telegram.WebApp;

// User Data
const userId = tg.initDataUnsafe.user ? tg.initDataUnsafe.user.id : "guest_" + Math.floor(Math.random()*1000);
const userName = tg.initDataUnsafe.user ? tg.initDataUnsafe.user.first_name : "Player";

let user = {
    score: 0, energy: 1000, maxE: 1000, 
    tap: 1, upT: 0, upE: 0, 
    name: userName, lastClaim: 0
};

let canSave = false;

// Initialize
db.ref('users/' + userId).once('value', (snap) => {
    if (snap.exists()) {
        user = Object.assign(user, snap.val());
    } else {
        db.ref('users/' + userId).set(user);
    }
    canSave = true;
    updateUI();
    if(localStorage.getItem('lang')) {
        currentLang = localStorage.getItem('lang');
        document.getElementById('lang-overlay').style.display = 'none';
        applyLang();
    }
});

function updateUI() {
    document.getElementById('balance').innerText = Math.floor(user.score).toLocaleString();
    document.getElementById('energy-val').innerText = `${Math.floor(user.energy)}/${user.maxE}`;
    document.getElementById('energy-fill').style.width = (user.energy / user.maxE * 100) + "%";
    document.getElementById('u-name').innerText = user.name;
    document.getElementById('u-id').innerText = "ID: " + userId;
    document.getElementById('lv-tap').innerText = "Level " + (user.upT + 1);
    document.getElementById('lv-energy').innerText = "Level " + (user.upE + 1);
    document.getElementById('btn-up-tap').innerText = (500 * (user.upT + 1));
    document.getElementById('btn-up-energy').innerText = (1000 * (user.upE + 1));
    document.getElementById('ref-link').value = `https://t.me/MTM_Coin_App_bot?start=${userId}`;
    checkDailyStatus();
}

// Tap Logic
document.getElementById('coin').addEventListener('pointerdown', (e) => {
    if (!canSave || user.energy < user.tap) return;
    
    user.score += user.tap;
    user.energy -= user.tap;

    // Visual Effect
    let pop = document.createElement('div');
    pop.className = 'tap-pop';
    pop.innerText = "+" + user.tap;
    pop.style.left = e.clientX + "px";
    pop.style.top = e.clientY + "px";
    document.body.appendChild(pop);
    setTimeout(() => pop.remove(), 700);
    
    if(tg.HapticFeedback) tg.HapticFeedback.impactOccurred('light');
    updateUI();
});

// Upgrades
function buyUpgrade(type) {
    let cost = (type === 'tap') ? 500*(user.upT+1) : 1000*(user.upE+1);
    if(user.score >= cost) {
        user.score -= cost;
        if(type === 'tap') { user.tap++; user.upT++; }
        else { user.maxE += 500; user.upE++; user.energy = user.maxE; }
        updateUI();
        db.ref('users/' + userId).update(user);
    }
}

// Leaderboard Function
function updateRank() {
    const list = document.getElementById('rank-list');
    list.innerHTML = "<p style='text-align:center'>Loading...</p>";
    
    db.ref('users').orderByChild('score').limitToLast(20).once('value', (snap) => {
        list.innerHTML = "";
        let players = [];
        snap.forEach(child => { players.push(child.val()); });
        players.reverse();

        players.forEach((p, i) => {
            let medal = i === 0 ? "ğŸ¥‡" : i === 1 ? "ğŸ¥ˆ" : i === 2 ? "ğŸ¥‰" : `#${i+1}`;
            list.innerHTML += `
                <div class="rank-item" style="${p.name === user.name ? 'border: 1px solid gold;' : ''}">
                    <div class="rank-num">${medal}</div>
                    <div class="rank-name">${p.name}</div>
                    <div class="rank-score">${Math.floor(p.score).toLocaleString()}</div>
                </div>
            `;
        });
    });
}

// Auto Energy & Auto Save
setInterval(() => {
    if(canSave) {
        if(user.energy < user.maxE) user.energy = Math.min(user.maxE, user.energy + 1);
        updateUI();
    }
}, 1500);

setInterval(() => { if(canSave) db.ref('users/' + userId).update(user); }, 10000);

// Page Navigation
function showPage(pageId, navEl) {
    document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
    document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
    document.getElementById(pageId).classList.add('active');
    navEl.classList.add('active');
}

// Translation System
const langData = {
    ar: { bLabel:"Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø±ØµÙŠØ¯", bHead:"Ø§Ù„ØªØ·ÙˆÙŠØ±Ø§Øª", mtap:"Ù‚ÙˆØ© Ø§Ù„Ù†Ù‚Ø±Ø©", elimit:"Ø³Ø¹Ø© Ø§Ù„Ø·Ø§Ù‚Ø©", rHead:"Ø§Ù„Ù…ØªØµØ¯Ø±ÙˆÙ† ğŸ†", fHead:"Ø§Ù„Ø£ØµØ¯Ù‚Ø§Ø¡", n1:"ØªØ¹Ø¯ÙŠÙ†", n2:"ØªØ·ÙˆÙŠØ±", n3:"ØªØ±ØªÙŠØ¨", n4:"Ø¥Ø­Ø§Ù„Ø©" },
    en: { bLabel:"Total Balance", bHead:"Upgrades", mtap:"Multitap", elimit:"Energy Limit", rHead:"Leaderboard ğŸ†", fHead:"Friends", n1:"Tap", n2:"Boost", n3:"Rank", n4:"Ref" }
};
let currentLang = 'ar';
function setLanguage(l) { currentLang = l; localStorage.setItem('lang', l); document.getElementById('lang-overlay').style.display = 'none'; applyLang(); }
function applyLang() {
    const l = langData[currentLang];
    document.getElementById('txt-balance-label').innerText = l.bLabel;
    document.getElementById('txt-boost-head').innerText = l.bHead;
    document.getElementById('txt-multitap').innerText = l.mtap;
    document.getElementById('txt-energy-limit').innerText = l.elimit;
    document.getElementById('txt-rank-head').innerText = l.rHead;
    document.getElementById('txt-ref-head').innerText = l.fHead;
    document.getElementById('n-tap').innerText = l.n1; document.getElementById('n-boost').innerText = l.n2;
    document.getElementById('n-rank').innerText = l.n3; document.getElementById('n-ref').innerText = l.n4;
}

function showLangSelect() { document.getElementById('lang-overlay').style.display = 'flex'; }
function copyLink() { navigator.clipboard.writeText(document.getElementById('ref-link').value); tg.showAlert("ØªÙ… Ø§Ù„Ù†Ø³Ø®!"); }
function claimDaily() { /* Ù…Ù†Ø·Ù‚ Ø§Ù„Ù…Ø·Ø§Ù„Ø¨Ø© Ø§Ù„ÙŠÙˆÙ…ÙŠØ© */ }
function checkDailyStatus() { /* Ù…Ù†Ø·Ù‚ ÙØ­Øµ Ø§Ù„ÙˆÙ‚Øª */ }
</script>
</body>
</html>
